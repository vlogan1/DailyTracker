<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Your Topics</title>
    <link rel="stylesheet" href="styles/common.css" />
    <link rel="stylesheet" href="styles/topics.css">
  </head>
  <body>
    <header>
      <h1>Manage Your Topics</h1>
    </header>

    <nav>
      <a href="home.html">Home</a>
      <a href="record.html">Record</a>
      <a href="create.html">Create</a>
      <a href="topics.html">Topics</a>
      <a href="history.html">History</a>
    </nav>
    <div class="line"></div>

    <div><h1>Your Topics</h1></div>
    <div id="topicsContainer"></div>

    <script>
      let topics = JSON.parse(localStorage.getItem("topics") || "[]");

      function renderTopics() {
        const container = document.getElementById("topicsContainer");
        container.innerHTML = "";

        topics.forEach((topic, index) => {
          const topicDiv = document.createElement("div");
          topicDiv.className = "topic-item";

          const header = document.createElement("div");
          header.className = "topic-header";

          const renameInput = document.createElement("input");
          renameInput.type = "text";
          renameInput.value = topic.name;
          renameInput.style.marginRight = "10px";

          const saveRenameBtn = document.createElement("button");
          saveRenameBtn.textContent = "Save";
          saveRenameBtn.onclick = () => {
            topics[index].name = renameInput.value.trim();
            saveTopics();
          };

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.onclick = () => {
            if (confirm(`Delete topic '${topic.name}'?`)) {
              topics.splice(index, 1);
              saveTopics();
            }
          };

          header.appendChild(renameInput);
          header.appendChild(saveRenameBtn);
          header.appendChild(deleteBtn);

          const levels = document.createElement("ul");
          topic.levels.forEach((level, levelIndex) => {
            const li = document.createElement("li");
            li.innerHTML = `
              <input type="text" value="${level.name}" onchange="updateLevelName(${index}, ${levelIndex}, this.value)">
              <input type="color" value="${level.color}" onchange="updateLevelColor(${index}, ${levelIndex}, this.value)">
            `;
            levels.appendChild(li);
          });

          const addLevelBtn = document.createElement("button");
          addLevelBtn.textContent = "+ Add Level";
          addLevelBtn.onclick = () => {
            topics[index].levels.push({ name: "New Level", color: "#cccccc" });
            saveTopics();
          };

          topicDiv.appendChild(header);
          topicDiv.appendChild(levels);
          topicDiv.appendChild(addLevelBtn);
          container.appendChild(topicDiv);
        });
      }

      function updateLevelName(topicIndex, levelIndex, value) {
        topics[topicIndex].levels[levelIndex].name = value.trim();
        saveTopics();
      }

      function updateLevelColor(topicIndex, levelIndex, color) {
        topics[topicIndex].levels[levelIndex].color = color;
        saveTopics();
      }

      function saveTopics() {
        localStorage.setItem("topics", JSON.stringify(topics));
        renderTopics();
      }

      renderTopics();
    </script>
  </body>
</html>
